<!DOCTYPE html>
<html>
<head>
  <script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js';
  import { getDatabase, ref, onValue, set } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js';
  
  // ステップ3のfirebaseConfigをここ貼り付け
  const firebaseConfig = { 'https://csv-sync-app-35682-default-rtdb.asia-southeast1.firebasedatabase.app/' };
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  
  // CSVデータ用参照（グローバル）
  window.csvRef = ref(db, 'csvData');
</script>
</head>
<body>
  <h1>A側: クリックでItem1のstatusをtrueに</h1>
  <button onclick="updateData()">更新クリック</button>
  <div id="status">読み込み中...</div>
  <script>
    async function loadCSV() {
  try {
    let response = await fetch('data.csv');
    let csvStr = await response.text();
    localStorage.setItem('sharedCSV', csvStr);  // 初回同期
    return Papa.parse(csvStr, {header: true}).data;
  } catch(e) {
    // ファイルなし時はlocalStorage使用
    let csvStr = localStorage.getItem('sharedCSV') || 'id,name,status\n1,Item1,false';
    return Papa.parse(csvStr, {header: true}).data;
  }
}
function updateData() {
  const data = [
    {id:1, name:'Item1', status: true},
    {id:2, name:'Item2', status: false}
  ];
  set(window.csvRef, data);  // 全員即反映
}

    function saveCSV(data) {
      let csvStr = Papa.unparse(data);
      localStorage.setItem('sharedCSV', csvStr);
    }
    function updateData() {
      let data = loadCSV();
      data[0].status = 'true';  // Item1更新
      saveCSV(data);
      document.getElementById('status').innerHTML = '更新完了: ' + JSON.stringify(data[0]);
    }
    // ページロード時表示
    window.onload = () => {
      document.getElementById('status').innerHTML = '現在: ' + JSON.stringify(loadCSV());
    };
  </script>
</body>
</html>
