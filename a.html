<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>A側 - CSV更新</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
  <h1>A側: クリックでItem1のstatusをtrueに</h1>
  <button onclick="updateData()">更新クリック</button>
  <div id="status">読み込み中...</div>
  <script>
    async function loadCSV() {
  try {
    let response = await fetch('data.csv');
    let csvStr = await response.text();
    localStorage.setItem('sharedCSV', csvStr);  // 初回同期
    return Papa.parse(csvStr, {header: true}).data;
  } catch(e) {
    // ファイルなし時はlocalStorage使用
    let csvStr = localStorage.getItem('sharedCSV') || 'id,name,status\n1,Item1,false';
    return Papa.parse(csvStr, {header: true}).data;
  }
}

    function saveCSV(data) {
      let csvStr = Papa.unparse(data);
      localStorage.setItem('sharedCSV', csvStr);
    }
    function updateData() {
      let data = loadCSV();
      data[0].status = 'true';  // Item1更新
      saveCSV(data);
      document.getElementById('status').innerHTML = '更新完了: ' + JSON.stringify(data[0]);
    }
    // ページロード時表示
    window.onload = () => {
      document.getElementById('status').innerHTML = '現在: ' + JSON.stringify(loadCSV());
    };
  </script>
</body>
</html>
