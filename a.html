<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Aå´ - Firebase v10ä¿®æ­£ç‰ˆ</title>
</head>
<body>
  <h1>ğŸš€ Aå´: ã‚¯ãƒªãƒƒã‚¯å³å…¨ä¸–ç•ŒåŒæœŸ</h1>
  <button onclick="updateData()">Item1 trueæ›´æ–°</button>
  <button onclick="addRow()">æ–°è¡Œè¿½åŠ </button>
  <div id="status">æ¥ç¶šä¸­...</div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js';
    import { getDatabase, ref, onValue, update, set } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js';
    
      const firebaseConfig = {
    apiKey: "AIzaSyDyr-r4YdBjark6GpoUgPBtW8NLMj6hUjE",
    authDomain: "csv-sync-app-35682.firebaseapp.com",
    databaseURL: "https://csv-sync-app-35682-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "csv-sync-app-35682",
    storageBucket: "csv-sync-app-35682.firebasestorage.app",
    messagingSenderId: "748623311917",
    appId: "1:748623311917:web:0a1118a75dd237ff5d34a4"
  }; 
    
  
    
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    
    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–
    const csvRef = ref(db, 'csvData');
    onValue(csvRef, (snapshot) => {
      // b.htmlã®onValueå†…
      const dataObj = snapshot.val() || {};
      const data = Object.entries(dataObj).map(([key, row]) => ({...row, key})).sort((a,b) => a.id - b.id);

      document.getElementById('status').innerHTML = `è¡Œæ•°: ${Object.keys(data).length}`;
    });
    
    // v10æ­£ã—ã„æ›´æ–°æ–¹æ³•
    window.updateData = () => {
      // Item1ï¼ˆid=1ï¼‰ã‚’ç‰¹å®šæ›´æ–°
      const item1Ref = ref(db, 'csvData/1');
      update(item1Ref, { status: true }).then(() => {
        document.getElementById('status').innerHTML += ' âœ… æ›´æ–°æˆåŠŸ';
      }).catch(e => {
        document.getElementById('status').innerHTML = 'âŒ ' + e.message;
      });
    };
    
    window.addRow = () => {
      const newId = Date.now().toString();
      const newRowRef = ref(db, `csvData/${newId}`);
      set(newRowRef, {
        id: newId,
        name: `NewItem-${newId.slice(-4)}`,
        status: false
      });
    };
    
    // åˆå›ãƒ‡ãƒ¼ã‚¿ï¼ˆè‡ªå‹•ï¼‰
    const initRef = ref(db, 'csvData');
    set(initRef, {
      '1': {id:1, name:'Item1', status: false},
      '2': {id:2, name:'Item2', status: false},
      '3': {id:3, name:'Item3', status: false}
    });
  </script>
</body>
</html>

  
