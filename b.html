<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>B側 - CSV表示</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
  <h1>B側: A側の変更をリアルタイム表示</h1>
  <div id="display">読み込み中...</div>
  <script>
    async function loadCSV() {
  try {
    let response = await fetch('data.csv');
    let csvStr = await response.text();
    localStorage.setItem('sharedCSV', csvStr);  // 初回同期
    return Papa.parse(csvStr, {header: true}).data;
  } catch(e) {
    // ファイルなし時はlocalStorage使用
    let csvStr = localStorage.getItem('sharedCSV') || 'id,name,status\n1,Item1,false';
    return Papa.parse(csvStr, {header: true}).data;
  }
}

    function displayCSV() {
      let data = loadCSV();
      if (data.length === 0 || data[0].id === undefined) {
        document.getElementById('display').innerHTML = 'データなし';
        return;
      }
      let html = '<table border="1"><tr><th>ID</th><th>Name</th><th>Status</th></tr>';
      data.forEach(row => {
        html += `<tr><td>${row.id}</td><td>${row.name}</td><td style="color:${row.status === 'true' ? 'green' : 'red'}">${row.status}</td></tr>`;
      });
      html += '</table>';
      document.getElementById('display').innerHTML = html;
    }
    // ロード時 + 1秒ポーリング
    window.onload = () => {
      displayCSV();
      setInterval(displayCSV, 1000);
    };
  </script>
</body>
</html>
