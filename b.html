<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>B側 - CSV表示</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
  <h1>B側: A側の変更をリアルタイム表示</h1>
  <div id="display">読み込み中...</div>
  <div id="debug"></div>  <!-- デバッグ用追加 -->
  <script>
    function loadCSV() {
      let csvStr = localStorage.getItem('sharedCSV');
      document.getElementById('debug').innerHTML = 'localStorage: ' + (csvStr ? csvStr.substring(0,100)+'...' : 'null');
      if (!csvStr) return [];
      try {
        return Papa.parse(csvStr, {header: true, skipEmptyLines: true}).data;
      } catch(e) {
        document.getElementById('debug').innerHTML += '<br>Parseエラー: ' + e.message;
        return [];
      }
    }
    function displayCSV() {
      let data = loadCSV();
      let debugEl = document.getElementById('debug');
      if (!data || data.length === 0 || !data[0]) {
        document.getElementById('display').innerHTML = 'データなし（A側で最初にクリック？）';
        return;
      }
      let html = '<table border="1"><tr><th>ID</th><th>Name</th><th>Status</th></tr>';
      data.forEach(row => {
        html += `<tr><td>${row.id || ''}</td><td>${row.name || ''}</td><td style="color:${row.status === 'true' ? 'green' : 'red'}">${row.status || ''}</td></tr>`;
      });
      html += '</table> 行数: ' + data.length;
      document.getElementById('display').innerHTML = html;
      debugEl.innerHTML += ' → 表示成功';
    }
    window.onload = () => {
      displayCSV();
      setInterval(displayCSV, 1000);
    };
  </script>
</body>
</html>
